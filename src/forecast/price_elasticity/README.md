## 价格的预处理

### 处理逻辑
#### 1、大单的处理逻辑和出清时候价格处理逻辑在价格弹性里不做处理，保留原有的销量和价格

#### 2、当天销量为0时候价格处理逻辑
使用过去一段时间内价格的最大值来代替
#### 3、滑动窗口内的价格处理逻辑
当天销量为0，计算滑动窗口内的价格均价时候需要销量同时加一后进行加权平均

### 如何与销量还原结合
采用full outer join， 然后根据销量还原的数据对价格弹性的销量做相应的处理
当下个弹性得到的销量为空或者小于销量还原的销量，则用销量还原的结果进行替代

### 处理的流程
1、处理订单流水表获取当日销量，销售额，同时获取到当天的均价

2、outer join 上已经进行处理过后的销量数据（销售预测）

3、当销量表当天销量为0，并且销量还原表补0（当天有库存但是没销售），
则该日的价格用过去一段时间内的价格的最大值来代替

4、在已经有了最大价格基础上，处理当日销售表为0，
但是销量还原表不为0（表示当天缺货导致无销量，
如果当天有销量并且缺货的情况下也是可以计算价格的，默认当天价格，
并且销量设置为还原表中的销量（如果订单表统计的销量小于还原表中的销量））
5、生成最终的价格，同时给个标记来自于原始订单表，最大值还是均值
6、生成最终的销量，同时给个标记来自于原始订单表，还是来自销量还原表
## 数据需求
### 订单表
| No   | 字段           | 备注         |
| ---- | -------------- | ------------ |
| 1    | dt             | 日期         |
| 2    | site_code      | 门店编码     |
| 3    | goods_code     | 商品编码     |
| 4    | cat_code       | 品类编码     |
| 5    | bill_id        | 订单号       |
| 6    | qty            | 销量         |
| 7    | bill_time      | 订单生成时间 |
| 8    | standard_price | 标价         |
| 9    | selling_price  | 售价         |

### 销量还原表 (暂定这个表后面更换)

| 字段名   | 数据类型 | 注释     |
| -------- | -------- | -------- |
| shop_id  | string   | 门店编码 |
| goods_id | string   | 商品编码 |
| y_type   | string   | 时段     |
| ac_y     | string   | 实际销量 |
| th_y     | int      | 理论销量 |
| dt       | string   | 日期     |



